'''
84. Largest Rectangle in Histogram

Given an array of integers heights representing the histogram's bar height where the width of each bar is 1, return the area of the largest rectangle in the histogram.
'''

'''
å®ƒçš„ç²¾é«“æ˜¯ï¼š
å¦‚æžœæ˜¯å‡ï¼Œå°±ä¸€ç›´è¿›æ ˆï¼Œå› ä¸ºé¢ç§¯ä»æœ‰å¯èƒ½å¢žåŠ 
å¦‚æžœæ˜¯é™ï¼ˆæ¯”å½“å‰çš„ié«˜ï¼‰ï¼Œå°±é€ä¸€å¼¹å‡ºæ¯”å½“å‰ié«˜çš„ï¼Œç„¶åŽå€’ç€è®¡ç®—ã€æ¯”è¾ƒé¢ç§¯ï¼Œ
é¢ç§¯å°±æ˜¯ï¼Œé«˜ä¸ºå½“å‰popå‡ºçš„å€¼ï¼Œå®½ä¸º:ä»¥iå·¦è¾¹ä¸ºå³è¾¹ç•Œ(æ„æ€æ˜¯ä¸å¸¦i)ï¼Œä»¥popå®Œä¹‹åŽçš„æ ˆé‡Œçš„æœ€åŽä¸€ä¸ªindexçš„å³è¾¹ä¸ºå·¦è¾¹ç•Œ(æ„æ€æ˜¯ä¹Ÿä¸å¸¦é‚£ä¸ªæœ€åŽä¸€ä¸ªindex)
å› ä¸ºå€’ç€æ¥ï¼Œå› ä¸ºæ ˆé‡Œæ˜¯éžé™çš„ï¼ŒéåŽ†è‡³å½“å‰çš„é¢ç§¯çš„é«˜å°±æ˜¯popå‡ºçš„é‚£ä¸ªï¼Œå®½å°±æ˜¯popå‡ºçš„å·¦è¾¹è‡³iä¹‹å‰ã€‚
* ç„¶åŽ i else i - stack[-1] - 1
å°±æ˜¯è¯´ï¼Œå¦‚æžœå½“å‰stacké‡Œæ²¡æœ‰æ¯”å½“å‰çš„iä½Žçš„äº†ï¼Œå°±ä¸€ç›´é€šåˆ°åº•ï¼Œå› ä¸ºå¦‚æžœæœ‰æ¯”å®ƒä½Žçš„ï¼Œå°±ä¼šæŒ¡åœ¨ç¬¬ä¸€ä¸ªï¼Œä½œä¸ºå·¦è¾¹ç•Œã€‚
é‚£äº›æ›´é«˜çš„ï¼Œå°±å·²ç»æ‹”æŽ‰äº†ï¼Œå› ä¸ºå°±ç®—æ‹”æŽ‰äº†ï¼Œé«˜çš„çš„ä¸‹åŠèº«ä»ç„¶å¯ä»¥æŒç»­å­˜åœ¨ç»„æˆareaã€‚

å¦å¤–ä¸€ä¸ªç‚¹æ˜¯éœ€è¦ç»™heightsåŽŸæ•°ç»„é‡Œæ·»åŠ ä¸€ä¸ªé«˜ä¸º0çš„åœ¨æœ€åŽï¼Œæ–¹ä¾¿ç®—æœ¬æ¥çš„æœ€åŽä¸€ä¸ªå€¼ã€‚å› ä¸ºæ˜¯ç®—å½“å‰iä»¥å‰çš„ï¼Œæ‰€ä»¥å¦‚æžœè¦ç®—æœ€åŽä¸€ä¸ªå€¼ï¼Œè¦ç«™åœ¨æ¯”æœ€åŽä¸€ä¸ªå€¼æ›´å³çš„ä¸€ä¸ªåœ°æ–¹ã€‚
'''
def largestRectangleArea(heights: List[int]) -> int:
    stack = []
    res = 0
    heights.append(0)
    N = len(heights)
    for i in range(N):
        # print(i, heights[i], stack, res)
        while stack and heights[i] <= heights[stack[-1]]:
            h = heights[stack.pop()]
            
            w = i if not stack else i - stack[-1] - 1
            res = max(res, h * w)
        stack.append(i)
    return res


# ----------
'''
â†‘â†‘â†‘ whileé‡Œè®¡ç®—çš„æ˜¯è¢«popå‡ºçš„å†…å®¹çš„é¢ç§¯
â—â—â— ä¸ºä»€ä¹ˆåœ¨whileå¾ªçŽ¯é‡Œï¼Œçš„å·¦è¾¹ç•Œæ˜¯popå®Œä¹‹åŽï¼Œstackçš„æœ€åŽä¸€ä¸ªï¼Œè€Œä¸æ˜¯è¢«popçš„é‚£ä¸ªæœ¬èº«ï¼Œ
æ˜¯å› ä¸ºï¼Œå•è°ƒï¼ˆå‡ï¼‰æ ˆï¼Œiçš„å·¦è¾¹ä¸¤ç§æƒ…å†µï¼šæ— äº†ï¼Œæˆ–æ˜¯æ¯”iè¿˜å¤§çš„å€¼ï¼Œé‚£ä¹ˆè¦å¾€å·¦è¾¹å»¶ç”³çš„è¯ï¼Œä¸åœ¨æ ˆé‡Œçš„é‚£äº›æ˜¯åº”è¯¥è¦è¢«ç®—è¿›åŽ»çš„ï¼ˆå› ä¸ºæ¯”iå¤§ï¼‰ï¼Œæ‰€ä»¥å·¦è¾¹ç•Œä¸æ˜¯iæœ¬èº«ï¼Œè€Œæ˜¯iä¹‹å‰çš„ä¸€ä¸ªå€¼kï¼ˆ<â€” kæ˜¯ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ã€ä¸èƒ½ç®—çš„å€¼ï¼‰çš„åŽä¸€ä½

æš´åŠ›è§£æ³•ï¼šæœ¬è´¨æ˜¯ï¼Œå¯¹æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå·¦å³å»¶å±•æ¯”å®ƒé«˜çš„ï¼Œä¸ºå®½ï¼Œå®ƒè‡ªå·±ä¸ºé«˜ã€‚
è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š
whileé‡Œé¢å·¦å³è¾¹ç•Œåˆ¤æ–­é€€å‡ºæ˜¯ï¼Œæ˜¯ä¸æ»¡è¶³ðŸ‘†æ¡ä»¶ï¼Œä¸è¢«åŒ…å«åœ¨wé‡Œçš„é‚£è¾¹è¾¹ç•Œï¼Œæ‰€ä»¥åœ¨ç®—å®½çš„æ—¶å€™ä¸èƒ½æŠŠå®ƒä¿©ç®—è¿›åŽ»
'''
def largestRectangleArea(self, heights: List[int]) -> int:
    stack = []
    res = 0
    for i in range(len(heights)):
        left = right = i
        while left >= 0 and heights[left] >= heights[i]:
            left -= 1
        while right < len(heights) and heights[right] >= heights[i]:
            right += 1
        res = max(res, heights[i] * (right - left - 1))
        # print(left, i, left, res)
    return res